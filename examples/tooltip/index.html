<!doctype html>
<html lang=en-US>
<meta charset=utf8>
<meta name="viewport" content="width=device-width, initial-scale=1"><title>ProseMirror tooltip example</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel=stylesheet href=/css/site.css>

<header >
  <nav>
    <a class=logo href="/">ProseMirror</a>
    <div class=navlinks><a href="/examples/" class=active>Examples</a>
      <a href="/docs/" >Documentation</a>
      <a href="https://discuss.prosemirror.net/">Discuss</a>
      <a href="https://github.com/prosemirror">GitHub</a>
      <a href="https://twitter.com/prosemirror">Twitter</a>
    </div>
  </nav></header><article><h1>Tooltips</h1>
<p>I'm using ‘tooltip’ to mean a small interface element hovering over
the rest of the interface. These can be very useful in editors to show
extra controls or information, for example as in a ‘Medium-style’
editing interface (named after the popular blogging platform), where
most controls are hidden until you select something, at which point
they pop up as a little bubble above the selection.</p>
<p>There are two common ways to implement tooltips in ProseMirror. The
easiest is to insert widget
<a href="/docs/guide/#view.decorations">decorations</a> and absolutely position
them, relying on the fact that if you don't specify an explicit
position (as in a <code>left</code> or <code>bottom</code> property), such elements are
positioned at the point in the document flow where they are placed.
This works well for tooltips that correspond to a specific position.</p>
<p>If you want to position something above the selection, or you want to
animate transitions, or you need to be able to allow the tooltips to
stick out of the editor when the editor's <code>overflow</code> property isn't
<code>visible</code> (for example to make it scroll), then decorations are
probably not practical. In such a case, you'll have to ‘manually’
position your tooltips.</p>
<style>
  .tooltip {
    position: absolute;
    pointer-events: none;
    z-index: 20;
    background: white;
    border: 1px solid silver;
    border-radius: 2px;
    padding: 2px 10px;
    margin-bottom: 7px;
    -webkit-transform: translateX(-50%);
    transform: translateX(-50%);
  }
  .tooltip:before {
    content: "";
    height: 0; width: 0;
    position: absolute;
    left: 50%;
    margin-left: -5px;
    bottom: -6px;
    border: 5px solid transparent;
    border-bottom-width: 0;
    border-top-color: silver;
  }
  .tooltip:after {
    content: "";
    height: 0; width: 0;
    position: absolute;
    left: 50%;
    margin-left: -5px;
    bottom: -4.5px;
    border: 5px solid transparent;
    border-bottom-width: 0;
    border-top-color: white;
  }
  #editor { position: relative; }
</style>
<div id=editor></div>
<div style="display: none" id=content>
  <p>Select some text to see a tooltip with the size of your selection.</p>
  <p>(That's not the most useful use of a tooltip, but it's a nicely simple example.)</p>
</div>
<p>But you can still make use of ProseMirror's update cycle to make sure
the tooltip stays in sync with the editor state. We can use a <a href="/docs/ref/#state.PluginSpec.view">plugin
view</a> to create a view component tied to the
editor's life cycle.</p>
<pre><code class="language-javascript"><span class="tok-keyword">import</span> <span class="tok-punctuation">{</span><span class="tok-variableName tok-definition">Plugin</span><span class="tok-punctuation">}</span> <span class="tok-keyword">from</span> <span class="tok-string">&quot;prosemirror-state&quot;</span>

<span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">selectionSizePlugin</span> <span class="tok-operator">=</span> <span class="tok-keyword">new</span> <span class="tok-variableName">Plugin</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">view</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">editorView</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-keyword">new</span> <span class="tok-variableName">SelectionSizeTooltip</span><span class="tok-punctuation">(</span><span class="tok-variableName">editorView</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">}</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p>The actual view creates a DOM node to represent the tooltip and
inserts it into the document alongside the editor.</p>
<pre><code class="language-javascript"><span class="tok-keyword">class</span> <span class="tok-className">SelectionSizeTooltip</span> <span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">constructor</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">view</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span> <span class="tok-operator">=</span> <span class="tok-variableName">document</span><span class="tok-operator">.</span><span class="tok-propertyName">createElement</span><span class="tok-punctuation">(</span><span class="tok-string">&quot;div&quot;</span><span class="tok-punctuation">)</span>
    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">className</span> <span class="tok-operator">=</span> <span class="tok-string">&quot;tooltip&quot;</span>
    <span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">dom</span><span class="tok-operator">.</span><span class="tok-propertyName">parentNode</span><span class="tok-operator">.</span><span class="tok-propertyName">appendChild</span><span class="tok-punctuation">(</span><span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-punctuation">)</span>

    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">update</span><span class="tok-punctuation">(</span><span class="tok-variableName">view</span><span class="tok-punctuation">,</span> <span class="tok-keyword">null</span><span class="tok-punctuation">)</span>
  <span class="tok-punctuation">}</span>

  <span class="tok-propertyName tok-definition">update</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">view</span><span class="tok-punctuation">,</span> <span class="tok-variableName tok-definition">lastState</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
    <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">state</span> <span class="tok-operator">=</span> <span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">state</span>
    <span class="tok-comment">// Don't do anything if the document/selection didn't change</span>
    <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-variableName">lastState</span> <span class="tok-operator">&amp;&amp;</span> <span class="tok-variableName">lastState</span><span class="tok-operator">.</span><span class="tok-propertyName">doc</span><span class="tok-operator">.</span><span class="tok-propertyName">eq</span><span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">doc</span><span class="tok-punctuation">)</span> <span class="tok-operator">&amp;&amp;</span>
        <span class="tok-variableName">lastState</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">eq</span><span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span> <span class="tok-keyword">return</span>

    <span class="tok-comment">// Hide the tooltip if the selection is empty</span>
    <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">empty</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
      <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">style</span><span class="tok-operator">.</span><span class="tok-propertyName">display</span> <span class="tok-operator">=</span> <span class="tok-string">&quot;none&quot;</span>
      <span class="tok-keyword">return</span>
    <span class="tok-punctuation">}</span>

    <span class="tok-comment">// Otherwise, reposition it and update its content</span>
    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">style</span><span class="tok-operator">.</span><span class="tok-propertyName">display</span> <span class="tok-operator">=</span> <span class="tok-string">&quot;&quot;</span>
    <span class="tok-keyword">let</span> <span class="tok-punctuation">{</span><span class="tok-propertyName">from</span><span class="tok-punctuation">,</span> <span class="tok-propertyName">to</span><span class="tok-punctuation">}</span> <span class="tok-operator">=</span> <span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span>
    <span class="tok-comment">// These are in screen coordinates</span>
    <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">start</span> <span class="tok-operator">=</span> <span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">coordsAtPos</span><span class="tok-punctuation">(</span><span class="tok-variableName">from</span><span class="tok-punctuation">)</span><span class="tok-punctuation">,</span> <span class="tok-variableName tok-definition">end</span> <span class="tok-operator">=</span> <span class="tok-variableName">view</span><span class="tok-operator">.</span><span class="tok-propertyName">coordsAtPos</span><span class="tok-punctuation">(</span><span class="tok-variableName">to</span><span class="tok-punctuation">)</span>
    <span class="tok-comment">// The box in which the tooltip is positioned, to use as base</span>
    <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">box</span> <span class="tok-operator">=</span> <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">offsetParent</span><span class="tok-operator">.</span><span class="tok-propertyName">getBoundingClientRect</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span>
    <span class="tok-comment">// Find a center-ish x position from the selection endpoints (when</span>
    <span class="tok-comment">// crossing lines, end may be more to the left)</span>
    <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">left</span> <span class="tok-operator">=</span> <span class="tok-variableName">Math</span><span class="tok-operator">.</span><span class="tok-propertyName">max</span><span class="tok-punctuation">(</span><span class="tok-punctuation">(</span><span class="tok-variableName">start</span><span class="tok-operator">.</span><span class="tok-propertyName">left</span> <span class="tok-operator">+</span> <span class="tok-variableName">end</span><span class="tok-operator">.</span><span class="tok-propertyName">left</span><span class="tok-punctuation">)</span> <span class="tok-operator">/</span> <span class="tok-number">2</span><span class="tok-punctuation">,</span> <span class="tok-variableName">start</span><span class="tok-operator">.</span><span class="tok-propertyName">left</span> <span class="tok-operator">+</span> <span class="tok-number">3</span><span class="tok-punctuation">)</span>
    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">style</span><span class="tok-operator">.</span><span class="tok-propertyName">left</span> <span class="tok-operator">=</span> <span class="tok-punctuation">(</span><span class="tok-variableName">left</span> <span class="tok-operator">-</span> <span class="tok-variableName">box</span><span class="tok-operator">.</span><span class="tok-propertyName">left</span><span class="tok-punctuation">)</span> <span class="tok-operator">+</span> <span class="tok-string">&quot;px&quot;</span>
    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">style</span><span class="tok-operator">.</span><span class="tok-propertyName">bottom</span> <span class="tok-operator">=</span> <span class="tok-punctuation">(</span><span class="tok-variableName">box</span><span class="tok-operator">.</span><span class="tok-propertyName">bottom</span> <span class="tok-operator">-</span> <span class="tok-variableName">start</span><span class="tok-operator">.</span><span class="tok-propertyName">top</span><span class="tok-punctuation">)</span> <span class="tok-operator">+</span> <span class="tok-string">&quot;px&quot;</span>
    <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">textContent</span> <span class="tok-operator">=</span> <span class="tok-variableName">to</span> <span class="tok-operator">-</span> <span class="tok-variableName">from</span>
  <span class="tok-punctuation">}</span>

  <span class="tok-propertyName tok-definition">destroy</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">this</span><span class="tok-operator">.</span><span class="tok-propertyName">tooltip</span><span class="tok-operator">.</span><span class="tok-propertyName">remove</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">}</span>
<span class="tok-punctuation">}</span>
</code></pre>
<p>Whenever the editor state updates, it checks whether it needs to
update the tooltip. The positioning calculations are a bit involved,
but such is life with CSS. Basically, it uses ProseMirror's
<a href="/docs/ref/#view.EditorView.coordsAtPos"><code>coordsAtPos</code> method</a> to find the
screen coordinates of the selection, and uses those to set a <code>left</code>
and <code>bottom</code> property relative to the tooltip's offset parent, which
is the nearest absolutely or relatively positioned parent.</p>
<link rel=stylesheet href="../../css/editor.css">
<script src="../prosemirror.js"></script>
<script src="example.js"></script></article>

<footer>
  <nav>
    <a class=logo href=".">&nbsp;</a>
    <div class=navlinks>
      <a href="/backers.html">Backers</a>
      <a href="http://contributor-covenant.org/version/1/1/0/">Code of Conduct</a>
      <a href="https://discuss.prosemirror.net/">Discuss</a>
      <a href="https://github.com/prosemirror/prosemirror/issues">Report an Issue</a>
    </div>
  </nav>
</footer>

</html>