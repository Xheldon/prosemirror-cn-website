<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf8">
<meta name="viewport" content="width=device-width, initial-scale=1"><title>ProseMirror schema example</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/site.css">

<script src="https://www.googletagmanager.com/gtag/js?id=G-KQYXRE0B3X"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-KQYXRE0B3X')</script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5486286026923411"></script></head><body><div id="banner-info">æœ¬æ–‡æ¡£ä¸º GPT-4o + äººå·¥ç¿»è¯‘ï¼Œhover å¯ä»¥æ˜¾ç¤ºåŸæ–‡ã€‚<a style="cursor: pointer;" href="https://prosemirror-old.xheldon.com/examples/schema/" target="_blank">åŸå§‹ç¿»è¯‘åœ°å€</a>ã€‚ç¿»è¯‘æœ‰é—®é¢˜ï¼Ÿ<a style="cursor: pointer;" href="https://github.com/Xheldon/prosemirror-cn-website/blob/main/dict/examples/schema/index.json" target="_blank">æˆ‘æ¥ç¿»è¯‘ï¼</a></div><header>
  <nav>
    <a class="logo" href="/">ProseMirror</a>
    <div class="navlinks"><a href="/examples/" class="active">ç¤ºä¾‹</a>
      <a href="/docs/">æ–‡æ¡£</a>
      <a href="https://discuss.prosemirror.net/">è®ºå›</a>
      <a href="https://github.com/prosemirror">GitHub</a>
      <a href="https://twitter.com/prosemirror">Twitter</a>
    <a href="https://www.xheldon.com" target="_blank">è¯‘è€…</a></div>
  </nav></header><article>
<style>
  /* hover æ˜¾ç¤ºåŸæ–‡ */
  p[data-x-en],
  li[data-x-en] {
    position: relative;
  }
  p[data-x-en]:hover::after,
  li[data-x-en]:hover::after {
    visibility: visible;
    opacity: 1;
  }
  p[data-x-en]::after,
  li[data-x-en]::after {
    content: attr(data-x-en);
    display: block;
    font-size: 12px;
    transition: all 0.2s 0.3s;
    visibility: hidden;
    opacity: 0;
    background: #cccccc;
    z-index: 99;
    border-radius: 4px;
    padding: 5px 10px;
    position: absolute;
    top: 100%;
    left: 0;
  }
  /* è¯‘è€…æ³¨é‡Šå†…å®¹ */
  div[type='comment'] {
    border-radius: 4px;
    padding: 5px 10px;
    font-size: 12px;
    background: #eee;
  }
  div[type='comment']::before {
    content: 'è¯‘è€…æ³¨: ';
    font-weight: 900;
  }
  header a.logo {
    position: relative;
  }
  header a.logo::after {
    content: 'ä¸­æ–‡';
    position: absolute;
    left: calc(100% + 5px);
    font-size: 12px;
    width: 50px;
    top: -5px;
  }
  #banner-info {
    position: fixed;
    top: 0;
    left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    background: #fff;
    font-size: 14px;
    padding: 5px 0;
    z-index: 999;
  }
  #add-info {
    font-size: 14px;
  }
  blockquote {
    border-left: 5px solid #ccc;
    padding-left: 10px;
    margin-left: 0;
  }
</style><h1>Schemas from scratch</h1>
<p data-x-en="ProseMirror schemas provide something like a syntax for documentsâ€”they set down which structures are valid.">ProseMirror <a href="/docs/guide/#schema">æ¨¡å¼</a> æä¾›äº†ç±»ä¼¼äºæ–‡æ¡£è¯­æ³•çš„åŠŸèƒ½â€”â€”å®ƒä»¬è§„å®šäº†å“ªäº›ç»“æ„æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p data-x-en="The most simple schema possible allows the document to be composed just of text.">æœ€ç®€å•çš„æ¨¡å¼å…è®¸æ–‡æ¡£ä»…ç”±æ–‡æœ¬ç»„æˆã€‚</p>
<pre><code class="language-javascript"><span class="tok-keyword">import</span> <span class="tok-punctuation">{</span><span class="tok-variableName tok-definition">Schema</span><span class="tok-punctuation">}</span> <span class="tok-keyword">from</span> <span class="tok-string">"prosemirror-model"</span>

<span class="tok-keyword">const</span> <span class="tok-variableName tok-definition">textSchema</span> <span class="tok-operator">=</span> <span class="tok-keyword">new</span> <span class="tok-variableName">Schema</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">nodes</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
    <span class="tok-propertyName tok-definition">text</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span><span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">doc</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"text*"</span><span class="tok-punctuation">}</span>
  <span class="tok-punctuation">}</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p data-x-en="You can use it to edit inline content. (A ProseMirror view can be mounted on any node, including inline nodes.)">æ‚¨å¯ä»¥ç”¨å®ƒæ¥ç¼–è¾‘å†…è”å†…å®¹ã€‚<span id="text-editor"></span>
ï¼ˆProseMirror è§†å›¾å¯ä»¥<a href="/docs/ref/#view.EditorView.constructor">æŒ‚è½½</a>åœ¨ä»»ä½•èŠ‚ç‚¹ä¸Šï¼ŒåŒ…æ‹¬å†…è”èŠ‚ç‚¹ã€‚ï¼‰</p>
<h2>Blocks</h2>
<p data-x-en="To add more structure, you'll usually want to add some kind of block nodes. For example, this schema consists of notes that can optionally be grouped with group nodes.">ä¸ºäº†å¢åŠ æ›´å¤šçš„ç»“æ„ï¼Œæ‚¨é€šå¸¸ä¼šæƒ³è¦æ·»åŠ æŸç§å—èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œæ­¤æ¨¡å¼ç”±å¯ä»¥é€‰æ‹©ä¸ç»„èŠ‚ç‚¹åˆ†ç»„çš„ç¬”è®°ç»„æˆã€‚</p>
<pre><code class="language-javascript"><span class="tok-keyword">const</span> <span class="tok-variableName tok-definition">noteSchema</span> <span class="tok-operator">=</span> <span class="tok-keyword">new</span> <span class="tok-variableName">Schema</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">nodes</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
    <span class="tok-propertyName tok-definition">text</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span><span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">note</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"text*"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">toDOM</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"note"</span><span class="tok-punctuation">,</span> <span class="tok-number">0</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"note"</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">notegroup</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"note+"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">toDOM</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"notegroup"</span><span class="tok-punctuation">,</span> <span class="tok-number">0</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"notegroup"</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">doc</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"(note | notegroup)+"</span>
    <span class="tok-punctuation">}</span>
  <span class="tok-punctuation">}</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p data-x-en="For nodes that aren't text or top-level nodes, it is necessary to provide toDOM methods, so that the editor can render them, and parseDOM values, so that they can be parsed. This schema uses custom DOM nodes <note> and <notegroup> to represent its nodes.">å¯¹äºä¸æ˜¯æ–‡æœ¬æˆ–é¡¶çº§èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œ<a href="/docs/guide/#schema.serialization_and_parsing">æœ‰å¿…è¦</a>æä¾›<a href="/docs/ref/#model.NodeSpec.toDOM"><code>toDOM</code></a>æ–¹æ³•ï¼Œä»¥ä¾¿ç¼–è¾‘å™¨å¯ä»¥æ¸²æŸ“å®ƒä»¬ï¼Œå¹¶æä¾›<a href="/docs/ref/#model.NodeSpec.parseDOM"><code>parseDOM</code></a>å€¼ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥è¢«è§£æã€‚æ­¤æ¨¡å¼ä½¿ç”¨è‡ªå®šä¹‰çš„ DOM èŠ‚ç‚¹<code>&lt;note&gt;</code>å’Œ<code>&lt;notegroup&gt;</code>æ¥è¡¨ç¤ºå…¶èŠ‚ç‚¹ã€‚</p>
<style>
  #text-editor { background-color: rgba(0, 0, 0, 0.05); padding: 0 }
  .ProseMirror { min-height: none !important }
  .ProseMirror a { text-decoration: underline; }
  note, notegroup { display: block; border: 1px solid silver; border-radius: 3px; padding: 3px 6px; margin: 5px 0; }
  notegroup { border-color: #66f }
  p.boring { background: #eee; color: #444; }
  shouting { display: inline; text-transform: uppercase; font-weight: bold; }
  star { display: inline; font-size: 190%; line-height: 1; vertical-align: -10%; color: #a8f; -webkit-text-stroke: 1px #75b; }
</style>
<div id="note-editor"></div>
<p data-x-en="You can press ctrl-space to add a group around the selected notes. To get that functionality, you first have to implement a custom editing command. Something like this:">æ‚¨å¯ä»¥æŒ‰ ctrl-space ä¸ºé€‰å®šçš„éŸ³ç¬¦æ·»åŠ ä¸€ä¸ªç»„ã€‚è¦å®ç°è¯¥åŠŸèƒ½ï¼Œæ‚¨é¦–å…ˆéœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„<a href="/docs/guide/#commands">ç¼–è¾‘å‘½ä»¤</a>ã€‚ç±»ä¼¼è¿™æ ·çš„ï¼š</p>
<pre><code class="language-javascript"><span class="tok-keyword">import</span> <span class="tok-punctuation">{</span><span class="tok-variableName tok-definition">findWrapping</span><span class="tok-punctuation">}</span> <span class="tok-keyword">from</span> <span class="tok-string">"prosemirror-transform"</span>

<span class="tok-keyword">function</span> <span class="tok-variableName tok-definition">makeNoteGroup</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">state</span><span class="tok-punctuation">,</span> <span class="tok-variableName tok-definition">dispatch</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
  <span class="tok-comment">// è·å–é€‰å®šå—å‘¨å›´çš„èŒƒå›´</span>
  <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">range</span> <span class="tok-operator">=</span> <span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">$from</span><span class="tok-operator">.</span><span class="tok-propertyName">blockRange</span><span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">$to</span><span class="tok-punctuation">)</span>
  <span class="tok-comment">// æŸ¥çœ‹æ˜¯å¦å¯ä»¥å°†è¯¥èŒƒå›´åŒ…è£…åœ¨ä¸€ä¸ªæ³¨é‡Šç»„ä¸­</span>
  <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">wrapping</span> <span class="tok-operator">=</span> <span class="tok-variableName">findWrapping</span><span class="tok-punctuation">(</span><span class="tok-variableName">range</span><span class="tok-punctuation">,</span> <span class="tok-variableName">noteSchema</span><span class="tok-operator">.</span><span class="tok-propertyName">nodes</span><span class="tok-operator">.</span><span class="tok-propertyName">notegroup</span><span class="tok-punctuation">)</span>
  <span class="tok-comment">// å¦‚æœæ²¡æœ‰ï¼Œè¯¥å‘½ä»¤ä¸é€‚ç”¨</span>
  <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-operator">!</span><span class="tok-variableName">wrapping</span><span class="tok-punctuation">)</span> <span class="tok-keyword">return</span> <span class="tok-bool">false</span>
  <span class="tok-comment">// å¦åˆ™ï¼Œä½¿ç”¨ `wrap` æ–¹æ³•è°ƒåº¦ä¸€ä¸ªäº‹åŠ¡ï¼Œ</span>
  <span class="tok-comment">// åˆ›å»ºæ‰§è¡Œå®é™…åŒ…è£…çš„æ­¥éª¤ã€‚</span>
  <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-variableName">dispatch</span><span class="tok-punctuation">)</span> <span class="tok-variableName">dispatch</span><span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">tr</span><span class="tok-operator">.</span><span class="tok-propertyName">wrap</span><span class="tok-punctuation">(</span><span class="tok-variableName">range</span><span class="tok-punctuation">,</span> <span class="tok-variableName">wrapping</span><span class="tok-punctuation">)</span><span class="tok-operator">.</span><span class="tok-propertyName">scrollIntoView</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span>
  <span class="tok-keyword">return</span> <span class="tok-bool">true</span>
<span class="tok-punctuation">}</span>
</code></pre>
<p data-x-en="A keymap like keymap({&quot;Ctrl-Space&quot;: makeNoteGroup}) can be used to enable it.">ä¸€ä¸ª<a href="/docs/ref/#keymap">é”®æ˜ å°„</a>å¦‚<code>keymap({"Ctrl-Space": makeNoteGroup})</code>å¯ä»¥ç”¨æ¥å¯ç”¨å®ƒã€‚</p>
<p data-x-en="The generic bindings for enter and backspace work just fine in this schemaâ€”enter will split the textblock around the cursor, or if that's empty, try to lift it out of its parent node, and thus can be used to create new notes and escape from a note group. Backspace at the start of a textblock will lift that textblock out of its parent, which can be used to remove notes from a group."><a href="/docs/ref/#commands.baseKeymap">é€šç”¨ç»‘å®š</a> å¯¹äºå›è½¦å’Œé€€æ ¼åœ¨è¿™ä¸ªæ¨¡å¼ä¸­å·¥ä½œå¾—å¾ˆå¥½â€”â€”å›è½¦ä¼šåœ¨å…‰æ ‡å‘¨å›´æ‹†åˆ†æ–‡æœ¬å—ï¼Œæˆ–è€…å¦‚æœå®ƒæ˜¯ç©ºçš„ï¼Œå°è¯•å°†å…¶ä»çˆ¶èŠ‚ç‚¹ä¸­æå–å‡ºæ¥ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥åˆ›å»ºæ–°ç¬”è®°å¹¶ä»ç¬”è®°ç»„ä¸­é€€å‡ºã€‚æ–‡æœ¬å—å¼€å¤´çš„é€€æ ¼ä¼šå°†è¯¥æ–‡æœ¬å—ä»å…¶çˆ¶èŠ‚ç‚¹ä¸­æå–å‡ºæ¥ï¼Œè¿™å¯ä»¥ç”¨æ¥ä»ç»„ä¸­ç§»é™¤ç¬”è®°ã€‚</p>
<h2>Groups and marks</h2>
<p data-x-en="Let's do one more, with stars and shouting.">è®©æˆ‘ä»¬å†æ¥ä¸€ä¸ªï¼Œæœ‰æ˜Ÿæ˜Ÿå’Œå–Šå«ã€‚</p>
<p data-x-en="This schema has not just text as inline content, but also stars, which are just inline nodes. To be able to easily refer to both our inline nodes, they are tagged as a group (also called &quot;inline&quot;). The schema does the same for the two types of block nodes, one paragraph type that allows any inline content, and one that only allows unmarked text.">è¿™ä¸ªæ¨¡å¼ä¸ä»…æœ‰æ–‡æœ¬ä½œä¸ºå†…è”å†…å®¹ï¼Œè¿˜æœ‰<em>æ˜Ÿæ˜Ÿ</em>ï¼Œå®ƒä»¬åªæ˜¯å†…è”èŠ‚ç‚¹ã€‚ä¸ºäº†èƒ½å¤Ÿè½»æ¾å¼•ç”¨æˆ‘ä»¬çš„å†…è”èŠ‚ç‚¹ï¼Œå®ƒä»¬è¢«æ ‡è®°ä¸ºä¸€ä¸ªç»„ï¼ˆä¹Ÿç§°ä¸º<code>"inline"</code>ï¼‰ã€‚è¯¥æ¨¡å¼å¯¹ä¸¤ç§ç±»å‹çš„å—èŠ‚ç‚¹ä¹Ÿåšäº†åŒæ ·çš„å¤„ç†ï¼Œä¸€ç§æ®µè½ç±»å‹å…è®¸ä»»ä½•å†…è”å†…å®¹ï¼Œå¦ä¸€ç§åªå…è®¸æœªæ ‡è®°çš„æ–‡æœ¬ã€‚</p>
<pre><code class="language-javascript"><span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">starSchema</span> <span class="tok-operator">=</span> <span class="tok-keyword">new</span> <span class="tok-variableName">Schema</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-propertyName tok-definition">nodes</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
    <span class="tok-propertyName tok-definition">text</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">group</span><span class="tok-punctuation">:</span> <span class="tok-string">"inline"</span><span class="tok-punctuation">,</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">star</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">inline</span><span class="tok-punctuation">:</span> <span class="tok-bool">true</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">group</span><span class="tok-punctuation">:</span> <span class="tok-string">"inline"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">toDOM</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"star"</span><span class="tok-punctuation">,</span> <span class="tok-string">"ğŸŸŠ"</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"star"</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">paragraph</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">group</span><span class="tok-punctuation">:</span> <span class="tok-string">"block"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"inline*"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">toDOM</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"p"</span><span class="tok-punctuation">,</span> <span class="tok-number">0</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"p"</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">boring_paragraph</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">group</span><span class="tok-punctuation">:</span> <span class="tok-string">"block"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"text*"</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">marks</span><span class="tok-punctuation">:</span> <span class="tok-string">""</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">toDOM</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"p"</span><span class="tok-punctuation">,</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">class</span><span class="tok-punctuation">:</span> <span class="tok-string">"boring"</span><span class="tok-punctuation">}</span><span class="tok-punctuation">,</span> <span class="tok-number">0</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-propertyName tok-definition">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"p.boring"</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">priority</span><span class="tok-punctuation">:</span> <span class="tok-number">60</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-propertyName tok-definition">doc</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-propertyName tok-definition">content</span><span class="tok-punctuation">:</span> <span class="tok-string">"block+"</span>
    <span class="tok-punctuation">}</span>
  <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
</code></pre>
<p data-x-en="Since textblocks allow marks by default, the boring_paragraph type sets marks to the empty string to explicitly forbid them.">ç”±äºæ–‡æœ¬å—é»˜è®¤å…è®¸æ ‡è®°ï¼Œ<code>boring_paragraph</code> ç±»å‹å°† <a href="/docs/ref/#model.NodeSpec.marks"><code>marks</code></a> è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ä»¥æ˜ç¡®ç¦æ­¢å®ƒä»¬ã€‚</p>
<p data-x-en="The schema defines two types of marks, shouted text and links. The first is like the common strong or emphasis marks, in that it just adds a single bit of information to the content it marks, and doesn't have any attributes. It specifies that it should be rendered as a <shouting> tag (which is styled to be inline, bold, and uppercase), and that that same tag should be parsed as this mark.">è¯¥æ¨¡å¼å®šä¹‰äº†ä¸¤ç§ç±»å‹çš„æ ‡è®°ï¼Œå–Šå«æ–‡æœ¬å’Œé“¾æ¥ã€‚ç¬¬ä¸€ä¸ªç±»ä¼¼äºå¸¸è§çš„å¼ºæˆ–å¼ºè°ƒæ ‡è®°ï¼Œå› ä¸ºå®ƒåªæ˜¯å‘å…¶æ ‡è®°çš„å†…å®¹æ·»åŠ äº†ä¸€ä½ä¿¡æ¯ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•å±æ€§ã€‚å®ƒæŒ‡å®šåº”å°†å…¶å‘ˆç°ä¸º<code>&lt;shouting&gt;</code>æ ‡ç­¾ï¼ˆæ ·å¼ä¸ºå†…è”ã€ç²—ä½“å’Œå¤§å†™ï¼‰ï¼Œå¹¶ä¸”åº”å°†åŒä¸€æ ‡ç­¾è§£æä¸ºæ­¤æ ‡è®°ã€‚</p>
<pre><code class="language-javascript">  <span class="tok-labelName">marks</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
    <span class="tok-labelName">shouting</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-variableName">toDOM</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"shouting"</span><span class="tok-punctuation">,</span> <span class="tok-number">0</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-labelName">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"shouting"</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span>
    <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
    <span class="tok-labelName">link</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span>
      <span class="tok-labelName">attrs</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span><span class="tok-labelName">href</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">{</span><span class="tok-punctuation">}</span><span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-variableName">toDOM</span><span class="tok-punctuation">(</span><span class="tok-variableName">node</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">[</span><span class="tok-string">"a"</span><span class="tok-punctuation">,</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">href</span><span class="tok-punctuation">:</span> <span class="tok-variableName">node</span><span class="tok-operator">.</span><span class="tok-propertyName">attrs</span><span class="tok-operator">.</span><span class="tok-propertyName">href</span><span class="tok-punctuation">}</span><span class="tok-punctuation">,</span> <span class="tok-number">0</span><span class="tok-punctuation">]</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">,</span>
      <span class="tok-labelName">parseDOM</span><span class="tok-punctuation">:</span> <span class="tok-punctuation">[</span><span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">tag</span><span class="tok-punctuation">:</span> <span class="tok-string">"a"</span><span class="tok-punctuation">,</span> <span class="tok-propertyName tok-definition">getAttrs</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">dom</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span> <span class="tok-keyword">return</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">href</span><span class="tok-punctuation">:</span> <span class="tok-variableName">dom</span><span class="tok-operator">.</span><span class="tok-propertyName">href</span><span class="tok-punctuation">}</span> <span class="tok-punctuation">}</span><span class="tok-punctuation">}</span><span class="tok-punctuation">]</span><span class="tok-punctuation">,</span>
      <span class="tok-variableName">inclusive</span><span class="tok-punctuation">:</span> <span class="tok-bool">false</span>
    <span class="tok-punctuation">}</span>
  <span class="tok-punctuation">}</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p data-x-en="Links do have an attributeâ€”their target URL, so their DOM serializing method has to output that (the second element in an array returned from toDOM, if it's a plain object, provides a set of DOM attributes), and their DOM parser has to read it.">é“¾æ¥ç¡®å®æœ‰ä¸€ä¸ªå±æ€§â€”â€”å®ƒä»¬çš„ç›®æ ‡URLï¼Œæ‰€ä»¥å®ƒä»¬çš„DOMåºåˆ—åŒ–æ–¹æ³•å¿…é¡»è¾“å‡ºè¿™ä¸ªï¼ˆä»<code>toDOM</code>è¿”å›çš„æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œåˆ™æä¾›ä¸€ç»„DOMå±æ€§ï¼‰ï¼Œå¹¶ä¸”å®ƒä»¬çš„DOMè§£æå™¨å¿…é¡»è¯»å–å®ƒã€‚</p>
<p data-x-en="By default, marks are inclusive, meaning that they get applied to content inserted at their end (as well as at their start when they start at the start of their parent node). For link-type marks, this is usually not the expected behavior, and the inclusive property on the mark spec can be set to false to disable that behavior.">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡è®°æ˜¯<em>åŒ…å«</em>çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¼šåº”ç”¨äºåœ¨å…¶æœ«ç«¯æ’å…¥çš„å†…å®¹ï¼ˆä»¥åŠåœ¨å®ƒä»¬ä»å…¶çˆ¶èŠ‚ç‚¹çš„å¼€å¤´å¼€å§‹æ—¶ï¼‰ã€‚å¯¹äºé“¾æ¥ç±»å‹çš„æ ‡è®°ï¼Œè¿™é€šå¸¸ä¸æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼Œå¯ä»¥å°†æ ‡è®°è§„èŒƒä¸­çš„<a href="/docs/ref/#model.MarkSpec.inclusive"><code>inclusive</code></a>å±æ€§è®¾ç½®ä¸ºfalseä»¥ç¦ç”¨è¯¥è¡Œä¸ºã€‚</p>
<div id="star-editor" class="editor"></div>
<div style="display: none">
  <div id="text-content">Such as this sentence.</div>
  <div id="note-content">
    <note>Do laundry</note>
    <note>Water the tomatoes</note>
    <notegroup>
      <note>Buy flour</note>
      <note>Get toilet paper</note>
    </notegroup>
  </div>
  <div id="star-content">
    <p data-x-en="This is a nice paragraph, it can have anything in it.">è¿™æ˜¯ä¸€ä¸ª<star></star>ä¸é”™çš„<star></star>æ®µè½ï¼Œå®ƒå¯ä»¥åŒ…å«<shouting>ä»»ä½•ä¸œè¥¿</shouting>ã€‚</p>
    <p class="boring" data-x-en="This paragraph is boring, it can't have anything.">è¿™ä¸ªæ®µè½å¾ˆæ— èŠï¼Œå®ƒä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚</p>
    <p data-x-en="Press ctrl/cmd-space to insert a star, ctrl/cmd-b to toggle shouting, and ctrl/cmd-q to add or remove a link.">æŒ‰ ctrl/cmd-ç©ºæ ¼ æ’å…¥æ˜Ÿå·ï¼ŒæŒ‰ ctrl/cmd-b åˆ‡æ¢å¤§å†™ï¼ŒæŒ‰ ctrl/cmd-q æ·»åŠ æˆ–åˆ é™¤é“¾æ¥ã€‚</p>
  </div>
</div>
<p data-x-en="To make it possible to interact with these elements we again have to add a custom keymap. There's a command helper for toggling marks, which we can use directly for the shouting mark.">ä¸ºäº†èƒ½å¤Ÿä¸è¿™äº›å…ƒç´ è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬å†æ¬¡éœ€è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰é”®æ˜ å°„ã€‚æœ‰ä¸€ä¸ªç”¨äºåˆ‡æ¢æ ‡è®°çš„å‘½ä»¤åŠ©æ‰‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨äºæ„Ÿå¹å·ã€‚</p>
<pre><code class="language-javascript"><span class="tok-keyword">import</span> <span class="tok-punctuation">{</span><span class="tok-variableName tok-definition">toggleMark</span><span class="tok-punctuation">}</span> <span class="tok-keyword">from</span> <span class="tok-string">"prosemirror-commands"</span>
<span class="tok-keyword">import</span> <span class="tok-punctuation">{</span><span class="tok-variableName tok-definition">keymap</span><span class="tok-punctuation">}</span> <span class="tok-keyword">from</span> <span class="tok-string">"prosemirror-keymap"</span>

<span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">starKeymap</span> <span class="tok-operator">=</span> <span class="tok-variableName">keymap</span><span class="tok-punctuation">(</span><span class="tok-punctuation">{</span>
  <span class="tok-string">"Ctrl-b"</span><span class="tok-punctuation">:</span> <span class="tok-variableName">toggleMark</span><span class="tok-punctuation">(</span><span class="tok-variableName">starSchema</span><span class="tok-operator">.</span><span class="tok-propertyName">marks</span><span class="tok-operator">.</span><span class="tok-propertyName">shouting</span><span class="tok-punctuation">)</span><span class="tok-punctuation">,</span>
  <span class="tok-string">"Ctrl-q"</span><span class="tok-punctuation">:</span> <span class="tok-variableName">toggleLink</span><span class="tok-punctuation">,</span>
  <span class="tok-string">"Ctrl-Space"</span><span class="tok-punctuation">:</span> <span class="tok-variableName">insertStar</span>
<span class="tok-punctuation">}</span><span class="tok-punctuation">)</span>
</code></pre>
<p data-x-en="Toggling a link is a little more involved. En- or disabling non-inclusive marks when nothing is selected isn't meaningful, since you can't â€œtype intoâ€™ them like you can with inclusive marks. And we need to ask the user for a URLâ€”but only if a link is being added. So the command uses rangeHasMark to check whether it will be adding or removing, before prompting for a URL.">åˆ‡æ¢é“¾æ¥ç¨å¾®å¤æ‚ä¸€äº›ã€‚å½“æ²¡æœ‰é€‰æ‹©ä»»ä½•å†…å®¹æ—¶ï¼Œå¯ç”¨æˆ–ç¦ç”¨éåŒ…å®¹æ€§æ ‡è®°æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºä½ ä¸èƒ½åƒä½¿ç”¨åŒ…å®¹æ€§æ ‡è®°é‚£æ ·â€œè¾“å…¥â€å®ƒä»¬ã€‚è€Œä¸”æˆ‘ä»¬éœ€è¦å‘ç”¨æˆ·è¯¢é—®ä¸€ä¸ªURLâ€”â€”ä½†åªæœ‰åœ¨æ·»åŠ é“¾æ¥æ—¶æ‰éœ€è¦ã€‚æ‰€ä»¥è¯¥å‘½ä»¤ä½¿ç”¨<a href="/docs/ref/#model.Node.rangeHasMark"><code>rangeHasMark</code></a>æ¥æ£€æŸ¥å®ƒæ˜¯æ·»åŠ è¿˜æ˜¯åˆ é™¤ï¼Œç„¶åå†æç¤ºè¾“å…¥URLã€‚</p>
<p data-x-en="(prompt is probably not what you'd want to use in a real system. When using an asynchronous method to query the user for something, make sure to use the current state, not the state when the command was originally called, when applying the command's effect.)">(<code>prompt</code> å¯èƒ½ä¸æ˜¯ä½ åœ¨å®é™…ç³»ç»Ÿä¸­æƒ³è¦ä½¿ç”¨çš„ã€‚
å½“ä½¿ç”¨å¼‚æ­¥æ–¹æ³•å‘ç”¨æˆ·æŸ¥è¯¢æŸäº›å†…å®¹æ—¶ï¼Œ
è¯·ç¡®ä¿ä½¿ç”¨<em>å½“å‰</em>çŠ¶æ€ï¼Œè€Œä¸æ˜¯å‘½ä»¤æœ€åˆè¢«è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼Œä»¥åº”ç”¨å‘½ä»¤çš„æ•ˆæœã€‚)</p>
<pre><code class="language-javascript"><span class="tok-keyword">function</span> <span class="tok-variableName tok-definition">toggleLink</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">state</span><span class="tok-punctuation">,</span> <span class="tok-variableName tok-definition">dispatch</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
  <span class="tok-keyword">let</span> <span class="tok-punctuation">{</span><span class="tok-propertyName">doc</span><span class="tok-punctuation">,</span> <span class="tok-propertyName">selection</span><span class="tok-punctuation">}</span> <span class="tok-operator">=</span> <span class="tok-variableName">state</span>
  <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-variableName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">empty</span><span class="tok-punctuation">)</span> <span class="tok-keyword">return</span> <span class="tok-bool">false</span>
  <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">attrs</span> <span class="tok-operator">=</span> <span class="tok-keyword">null</span>
  <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-operator">!</span><span class="tok-variableName">doc</span><span class="tok-operator">.</span><span class="tok-propertyName">rangeHasMark</span><span class="tok-punctuation">(</span><span class="tok-variableName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">from</span><span class="tok-punctuation">,</span> <span class="tok-variableName">selection</span><span class="tok-operator">.</span><span class="tok-propertyName">to</span><span class="tok-punctuation">,</span> <span class="tok-variableName">starSchema</span><span class="tok-operator">.</span><span class="tok-propertyName">marks</span><span class="tok-operator">.</span><span class="tok-propertyName">link</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
    <span class="tok-variableName">attrs</span> <span class="tok-operator">=</span> <span class="tok-punctuation">{</span><span class="tok-propertyName tok-definition">href</span><span class="tok-punctuation">:</span> <span class="tok-variableName">prompt</span><span class="tok-punctuation">(</span><span class="tok-string">"Link to where?"</span><span class="tok-punctuation">,</span> <span class="tok-string">""</span><span class="tok-punctuation">)</span><span class="tok-punctuation">}</span>
    <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-operator">!</span><span class="tok-variableName">attrs</span><span class="tok-operator">.</span><span class="tok-propertyName">href</span><span class="tok-punctuation">)</span> <span class="tok-keyword">return</span> <span class="tok-bool">false</span>
  <span class="tok-punctuation">}</span>
  <span class="tok-keyword">return</span> <span class="tok-variableName">toggleMark</span><span class="tok-punctuation">(</span><span class="tok-variableName">starSchema</span><span class="tok-operator">.</span><span class="tok-propertyName">marks</span><span class="tok-operator">.</span><span class="tok-propertyName">link</span><span class="tok-punctuation">,</span> <span class="tok-variableName">attrs</span><span class="tok-punctuation">)</span><span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-punctuation">,</span> <span class="tok-variableName">dispatch</span><span class="tok-punctuation">)</span>
<span class="tok-punctuation">}</span>
</code></pre>
<p data-x-en="The command that inserts a star first checks whether the schema allows one to be inserted at the cursor position (using canReplaceWith), and if so, replaces the selection with a newly created star node.">è¯¥å‘½ä»¤åœ¨æ’å…¥æ˜Ÿå·ä¹‹å‰ï¼Œé¦–å…ˆæ£€æŸ¥æ¨¡å¼æ˜¯å¦å…è®¸åœ¨å…‰æ ‡ä½ç½®æ’å…¥æ˜Ÿå·ï¼ˆä½¿ç”¨
<a href="/docs/ref/#model.Node.canReplaceWith"><code>canReplaceWith</code></a>ï¼‰ï¼Œå¦‚æœå…è®¸ï¼Œåˆ™ç”¨æ–°åˆ›å»ºçš„æ˜Ÿå·èŠ‚ç‚¹æ›¿æ¢é€‰åŒºã€‚</p>
<pre><code class="language-javascript"><span class="tok-keyword">function</span> <span class="tok-variableName tok-definition">insertStar</span><span class="tok-punctuation">(</span><span class="tok-variableName tok-definition">state</span><span class="tok-punctuation">,</span> <span class="tok-variableName tok-definition">dispatch</span><span class="tok-punctuation">)</span> <span class="tok-punctuation">{</span>
  <span class="tok-keyword">let</span> <span class="tok-variableName tok-definition">type</span> <span class="tok-operator">=</span> <span class="tok-variableName">starSchema</span><span class="tok-operator">.</span><span class="tok-propertyName">nodes</span><span class="tok-operator">.</span><span class="tok-propertyName">star</span>
  <span class="tok-keyword">let</span> <span class="tok-punctuation">{</span><span class="tok-propertyName">$from</span><span class="tok-punctuation">}</span> <span class="tok-operator">=</span> <span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">selection</span>
  <span class="tok-keyword">if</span> <span class="tok-punctuation">(</span><span class="tok-operator">!</span><span class="tok-variableName">$from</span><span class="tok-operator">.</span><span class="tok-propertyName">parent</span><span class="tok-operator">.</span><span class="tok-propertyName">canReplaceWith</span><span class="tok-punctuation">(</span><span class="tok-variableName">$from</span><span class="tok-operator">.</span><span class="tok-propertyName">index</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span><span class="tok-punctuation">,</span> <span class="tok-variableName">$from</span><span class="tok-operator">.</span><span class="tok-propertyName">index</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span><span class="tok-punctuation">,</span> <span class="tok-variableName">type</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span>
    <span class="tok-keyword">return</span> <span class="tok-bool">false</span>
  <span class="tok-variableName">dispatch</span><span class="tok-punctuation">(</span><span class="tok-variableName">state</span><span class="tok-operator">.</span><span class="tok-propertyName">tr</span><span class="tok-operator">.</span><span class="tok-propertyName">replaceSelectionWith</span><span class="tok-punctuation">(</span><span class="tok-variableName">type</span><span class="tok-operator">.</span><span class="tok-propertyName">create</span><span class="tok-punctuation">(</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span><span class="tok-punctuation">)</span>
  <span class="tok-keyword">return</span> <span class="tok-bool">true</span>
<span class="tok-punctuation">}</span>
</code></pre>
<link rel="stylesheet" href="../../css/editor.css">
<script src="../prosemirror.js"></script>
<script src="example.js"></script></article>

<footer>
  <nav>
    <a class="logo" href=".">&nbsp;</a>
    <div class="navlinks">
      <a href="/backers.html">Backers</a>
      <a href="http://contributor-covenant.org/version/1/1/0/">Code of Conduct</a>
      <a href="https://discuss.prosemirror.net/">Discuss</a>
      <a href="https://github.com/prosemirror/prosemirror/issues">Report an Issue</a>
    </div>
  </nav>
</footer>

</body></html>